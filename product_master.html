<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <title>Hello, world!</title>
  <link rel="stylesheet" href="header.css">
</head>
<body>
    <header class="header">
        <div class="menu-icon" onclick="toggleMenu()">☰</div>
        <div class="user-menu">
            <div class="user-menu">
                <div class="user-icon">&#128100;</div>
                <span id="usernamePlaceholder"></span>
                <div class="logout"><a href="#" id="logoutLink">Logout</a></div>
            </div>
        </div>
        <div class="menu-options" id="menuOptions">
            <a href="welcome.html">Home</a>
            <a href="#">About</a>
            <a href="product_master.html">Product Master</a>
            <a href="#">Services</a>
            <a href="#">Blog</a>
            <a href="#">Contact</a>
            <!-- Add more options as needed -->
        </div>
    </header>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="header.js"></script>
    <script>
        // Call the initializeHeader function when the document is ready
        $(document).ready(function () {
            initializeHeader();
        });


        // header.js

function toggleMenu() {
    var menuOptions = document.getElementById('menuOptions');
    var menuIcon = document.querySelector('.menu-icon');

    if (menuOptions.style.display === 'block') {
        menuOptions.style.display = 'none';
        menuIcon.innerHTML = '☰';
    } else {
        menuOptions.style.display = 'block';
        menuIcon.innerHTML = '✖';
    }
}

function initializeHeader() {
  var storedUsername = localStorage.getItem('username');
  var usernameInput = document.getElementById('username');
  
  if (storedUsername) {
      document.getElementById('usernamePlaceholder').textContent = storedUsername;
      usernameInput.value = storedUsername; // Set the value of the hidden input field
  } else {
      document.getElementById('usernamePlaceholder').textContent = 'Guest';
      usernameInput.value = 'Guest'; // Set the value of the hidden input field
  }

    $('#logoutLink').on('click', function (e) {
        e.preventDefault();

        // Ask for confirmation
        var confirmLogout = confirm("Are you sure you want to logout?");
        if (!confirmLogout) {
            return;
        }

        localStorage.removeItem('username');

        $.ajax({
            type: 'GET',
            url: 'logout_process.php',
            success: function (response) {
                if (response === 'success') {
                    window.location.href = 'login.html';
                } else {
                    alert('Logout failed. Please try again.');
                }
            },
            error: function () {
                alert('Error occurred during logout process');
            }
        });
    });
}

    </script>




  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <button type="button" class="btn btn-primary nav-link active" data-bs-toggle="modal" data-bs-target="#addProductModal">
              Add New
            </button>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="#" id="refreshButton">Refresh</a>
          </li>
          <li class="nav-item">
            <div class="form-inline">
              <div class="input-group">
                <input class="form-control" type="search" id="searchInput" placeholder="Search Product Code" aria-label="Search">
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container my-4">
    <table class="table" id="productTable">
      <!-- Table content will be populated dynamically using JavaScript -->
    </table>
  </div>
    
<!-- Add New Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="add_product.php" onsubmit="return confirmAddProduct();">
          <div class="mb-3">
            <label for="productCode" class="form-label">Product Code</label>
            <input type="text" class="form-control" id="productCode" name="productCode" required>
          </div>
          <div class="mb-3">
            <label for="productName" class="form-label">Product Name</label>
            <input type="text" class="form-control" id="productName" name="productName" required>
          </div>
          <div class="mb-3">
            <label for="UOM" class="form-label">Unit of Measure</label>
            <select class="form-select" id="UOM" name="UOM" required>
              <option value="" selected disabled>Select UOM</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="stock" class="form-label">Stock</label>
            <input type="number" class="form-control" id="stock" name="stock" required>
          </div>
          <div class="mb-3">
            <label for="sellingPrice" class="form-label">Selling Price</label>
            <input type="number" class="form-control" id="sellingPrice" name="sellingPrice" required>
          </div>
          <div class="mb-3">
            <label for="offerPrice" class="form-label">Offer Price</label>
            <input type="number" class="form-control" id="offerPrice" name="offerPrice" required>
          </div>
          <div class="mb-3">
            <label for="productImage" class="form-label">Product Image URL</label>
            <input type="text" class="form-control" id="productImage" name="productImage" required>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Add Product</button>
          </div>
          <input type="hidden" id="username" name="username" value="">
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Script to populate UOM options for Add New Product modal -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    populateUOMSelect('UOM');
  });
</script>

<script>
  function confirmAddProduct() {
    return confirm("Are you sure you want to add this product?");
  }
</script>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProductModalLabel">Edit Product Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="edit_product.php" onsubmit="return confirmEditProduct();">
          <div class="mb-3">
            <label for="editProductCode" class="form-label">Product Code</label>
            <input type="text" class="form-control" id="editProductCode" name="productCode" readonly>
          </div>
          <div class="mb-3">
            <label for="editProductName" class="form-label">Product Name</label>
            <input type="text" class="form-control" id="editProductName" name="productName" required>
          </div>
          <div class="mb-3">
            <label for="editUOM" class="form-label">Unit of Measure</label>
            <select class="form-select" id="editUOM" name="UOM" required>
              <!-- Options for Unit of Measure will be populated dynamically -->
            </select>
          </div>
          <div class="mb-3">
            <label for="editStock" class="form-label">Stock</label>
            <input type="number" class="form-control" id="editStock" name="stock" required>
          </div>
          <div class="mb-3">
            <label for="editSellingPrice" class="form-label">Selling Price</label>
            <input type="number" class="form-control" id="editSellingPrice" name="sellingPrice" required>
          </div>
          <div class="mb-3">
            <label for="editOfferPrice" class="form-label">Offer Price</label>
            <input type="number" class="form-control" id="editOfferPrice" name="offerPrice" required>
          </div>
          <div class="mb-3">
            <label for="editProductImage" class="form-label">Product Image URL</label>
            <input type="text" class="form-control" id="editProductImage" name="productImage" required>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Script to populate UOM options for Edit Product modal -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    populateUOMSelect('editUOM');
  });
</script>

<script>
  function confirmEditProduct() {
    return confirm("Are you sure you want to save these changes?");
  }
</script>


<script>
  function populateUOMSelect(elementId) {
    var uomSelect = document.getElementById(elementId);
    var uomOptions = ["", "kg", "g", "lb", "oz", "ltr", "ml", "m", "cm", "mm"];

    // Clear existing options
    uomSelect.innerHTML = '';

    // Add new options
    for (var i = 0; i < uomOptions.length; i++) {
      var option = document.createElement("option");
      option.value = uomOptions[i];
      option.text = uomOptions[i].charAt(0).toUpperCase() + uomOptions[i].slice(1); // Capitalize the first letter
      uomSelect.add(option);
    }
  }
</script>




 <!-- Bootstrap Bundle with Popper -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    // JavaScript to perform dynamic operations
    $(document).ready(function () {
      // Function to refresh the table
      function refreshProductTable() {
        $.ajax({
          url: 'get_products.php',
          type: 'GET',
          success: function (data) {
            $('#productTable').html(data);
          }
        });
      }

   // Event listener for the refresh button
    $('#refreshButton').click(function () {
    // Call the function to refresh with all data
    refreshProductTable();

    // Clear the search input
    $('#searchInput').val('');
});


// Event listener for the search input field
$('#searchInput').on('input', function () {
    var searchId = $(this).val();
    $.ajax({
        url: 'get_products.php',
        type: 'GET',
        data: { search: searchId },
        success: function (data) {
            $('#productTable').html(data);
        }
    });
});



// Event listener for the edit button
$(document).on("click", ".edit-product", function () {
    var productCode = $(this).data("id");
    var productName = $(this).data("name");
    var UOM = $(this).data("uom");
    var stock = $(this).data("stock");
    var sellingPrice = $(this).data("selling-price");
    var offerPrice = $(this).data("offer-price");
    var productImage = $(this).data("product-image");

    populateEditProductModal(productCode, productName, UOM, stock, sellingPrice, offerPrice, productImage);
});

// Function to populate the edit modal with selected product details
function populateEditProductModal(productCode, productName, UOM, stock, sellingPrice, offerPrice, productImage) {
    // Set values in the edit product modal input fields
    $("#editProductCode").val(productCode);
    $("#editProductName").val(productName);
    $("#editUOM").val(UOM);
    $("#editStock").val(stock);
    $("#editSellingPrice").val(sellingPrice);
    $("#editOfferPrice").val(offerPrice);
    $("#editProductImage").val(productImage);

    // Display the edit product modal
    $("#editProductModal").modal("show");
}





      // Initial table load
      refreshProductTable();
    });
  </script>
</body>
</html>